CREATE DATABASE School_Database
GO

USE School_Database
GO

CREATE TABLE Users (
    Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    Username NVARCHAR(100) NOT NULL,
    Email NVARCHAR(100) NOT NULL,
    Password NVARCHAR(256) NOT NULL,
    Role NVARCHAR(50) NOT NULL,
    IsActive BIT NOT NULL,
    CreatedAt DATETIME2 NOT NULL,
    CONSTRAINT UQ_Users_Email UNIQUE (Email)
)
GO

CREATE TABLE Teachers (
    Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Email NVARCHAR(100) NOT NULL,
    Department NVARCHAR(100) NULL,
    UserId INT NOT NULL,
    CONSTRAINT FK_Teachers_Users_UserId FOREIGN KEY (UserId) REFERENCES Users(Id),
    CONSTRAINT UQ_Teachers_UserId UNIQUE (UserId)
)
GO

CREATE TABLE Students (
    Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Email NVARCHAR(100) NOT NULL,
    EnrollmentDate DATETIME2 NOT NULL,
    UserId INT NOT NULL,
    CONSTRAINT FK_Students_Users_UserId FOREIGN KEY (UserId) REFERENCES Users(Id),
    CONSTRAINT UQ_Students_UserId UNIQUE (UserId)
)
GO

CREATE TABLE Courses (
    Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    CourseName NVARCHAR(100) NOT NULL,
    CourseCode NVARCHAR(50) NULL,
    Description NVARCHAR(255) NULL,
    CreatedDate DATETIME2 NOT NULL,
    TeacherId INT NOT NULL,
    CONSTRAINT FK_Courses_Teachers_TeacherId FOREIGN KEY (TeacherId) REFERENCES Teachers(Id)
)
GO

CREATE TABLE Enrollments (
    Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    StudentId INT NOT NULL,
    CourseId INT NOT NULL,
    EnrollmentDate DATETIME2 NOT NULL,
    CONSTRAINT FK_Enrollments_Students_StudentId FOREIGN KEY (StudentId) REFERENCES Students(Id),
    CONSTRAINT FK_Enrollments_Courses_CourseId FOREIGN KEY (CourseId) REFERENCES Courses(Id),
    CONSTRAINT UQ_Enrollments_Student_Course UNIQUE (StudentId, CourseId)
)
GO

INSERT INTO Users (Username, Email, Password, Role, IsActive, CreatedAt)
VALUES ('admin', 'admin@school.com', '03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4', 'Admin', 1, SYSUTCDATETIME())
GO
